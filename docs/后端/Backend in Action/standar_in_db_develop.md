# 在数据库开发中保持规范

### 建表规约 ###

- 表达是与否概念的字段，必须使用 f_is_xxx 的方式命名，数据类型是 tinyint。

- 表名、字段名必须使用小写字母或数字，表名使用tb_开头，字段使用f_开头。

- 能给定默认值的字段尽可能给定默认值，尽量少用NULL。

- MySQL 在 Windows 下不区分大小写，但在 Linux 下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。

- 表名不使用复数名词，比如members等。

- 禁用保留字，如 desc、range、match、delayed 等，请参考 MySQL 官方保留字。

- 主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名；外键使用 fk_表名_字段名_目标表名_目标字段。

- 建立数据表的时候，提交到团队git的SQL文件需要为每个数据表建表语句加上注释。

- 建议后端同学建表的时候可以考虑使用 comment 为每个字段加上注释！！！

- 命名时建议使用英文单词，单词间使用_分割，注意保证单词拼写正确。

### SQL 语句规约 ###

- 不要使用count(列名)或 count(常量)来替代 count(*)，count(*)是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。

> 说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。

- count(distinct col) 计算该列除 NULL 之外的不重复行数，注意 count(distinct
col1, col2) 如果其中一列全为 NULL，那么即使另一列有不同的值，也返回为 0。

- 当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为NULL，因此使用 sum()时,可以考虑使用这样的策略避免出现NULL：

```sql
SELECT IF(ISNULL(SUM(g)),0,SUM(g)) FROM table;
```

- 在代码中写分页查询逻辑时，若 count 为 0 时直接返回，避免执行后面的分页语句。

- 可以考虑在应用层面完成Cascade的操作，降低数据库查询的压力。

- **不允许使用'SELECT * FROM ...'的写法**，所有的查询字段都需要列明。

- 在使用Group By时，需要在SELECT中用到的字段，都需要在Group By子句中注明！！！

- **数据订正（特别是删除、修改记录操作）时，要先 select，避免出现误删除，确认无误才能执行更新语句**(特别重要！！！)。

### 数据库维护规范 ###
- 建立数据表，维护数据表禁止使用Navicat和Mysql Brench等数据库工具可视化完成（鄙视一切这样的行为）

- 禁止使用Navicat等数据库可视化工具手工删除大量数据

- 禁止在系统运行时随意更改数据库数据

- 在服务器进行数据删除或者更新前，需要严格检查清楚操作的数据库，数据表以及操作的记录是否正确

- 定期备份数据，学习灾备和数据库容灾！！！ **（已经出过两次磁盘故障了，说多了都是泪  :sob: ）** 

